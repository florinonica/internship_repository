<style>
body {
    font-family: 'Ubuntu', sans-serif;
    font-size: 20px;
}
</style>

<% if current_user.can_change_report_availability? %>
  <%= form_for @report, :url => {:action => :change_availability} do |form| %>
    <% if @report.is_available_to_clients? %>
      <%= form.hidden_field :available_to_clients, :value => 0 %>
      <p>
        <%= form.submit "Make unavailable to clients", {class: "btn btn-info collapsed", :style => 'font-size: 18px; font-weight: bold; font-family: "Ubuntu"'}%>
      </p>
    <% else %>
      <%= form.hidden_field :available_to_clients, :value => 1 %>
      <p>
        <%= form.submit "Make available to clients", {class: "btn btn-info collapsed", :style => 'font-size: 18px; font-weight: bold; font-family: "Ubuntu"'}%>
      </p>
    <% end %>
  <% end %>
<% end %>

<%= link_to 'Download', controller: "reports", action: "download", id: @report.id %>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
  google.charts.load('current', {'packages':['corechart']});
  google.charts.setOnLoadCallback(drawChart);
  function drawChart() {
    var data = google.visualization.arrayToDataTable([
    ['Ticket with status', 'Number of tickets'],
    ['To do', <%= @report.get_filtered_by_status("To do").count %>],
    ['In progress', <%= @report.get_filtered_by_status("In progress").count %>],
    ['Dev complete', <%= @report.get_filtered_by_status("Dev complete").count %>],
    ['Done', <%= @report.get_filtered_by_status("Done").count %>]
  ]);
    var options = {title: "Progress status", titleTextStyle: {color: 'black', fontName: 'Ubuntu', fontSize: 20}, pieHole: 0.4, 'width':750, 'height':600,
      pieSliceTextStyle: {color: 'white', fontName: 'Ubuntu', fontSize: 18}, legendTextStyle: {color: 'black', fontName: 'Ubuntu', fontSize: 18}};
    var chart = new google.visualization.PieChart(document.getElementById('piechart'));
    chart.draw(data, options);
  }
</script>
<script type='text/javascript'>
      google.charts.load('current', {'packages':['annotationchart']});
      google.charts.setOnLoadCallback(drawChart1);

      function drawChart1() {
        var data = new google.visualization.DataTable();
        data.addColumn('date', 'Date');
        data.addColumn('number', 'Kepler-22b mission');
        data.addColumn('string', 'Kepler title');
        data.addColumn('string', 'Kepler text');
        data.addColumn('number', 'Gliese 163 mission');
        data.addColumn('string', 'Gliese title');
        data.addColumn('string', 'Gliese text');
        data.addRows([
          [new Date(2314, 2, 15), 12400, undefined, undefined,
                                  10645, undefined, undefined],
          [new Date(2314, 2, 16), 24045, 'Lalibertines', 'First encounter',
                                  12374, undefined, undefined],
          [new Date(2314, 2, 17), 35022, 'Lalibertines', 'They are very tall',
                                  15766, 'Gallantors', 'First Encounter'],
          [new Date(2314, 2, 18), 12284, 'Lalibertines', 'Attack on our crew!',
                                  34334, 'Gallantors', 'Statement of shared principles'],
          [new Date(2314, 2, 19), 8476, 'Lalibertines', 'Heavy casualties',
                                  66467, 'Gallantors', 'Mysteries revealed'],
          [new Date(2314, 2, 20), 0, 'Lalibertines', 'All crew lost',
                                  79463, 'Gallantors', 'Omniscience achieved']
        ]);

        var chart = new google.visualization.AnnotationChart(document.getElementById('chart_div'));

        var options = {
          displayAnnotations: true
        };

        chart.draw(data, options);
      }
    </script>

<div style='display:flex'>
  <div>
    <h3>Employees </h3>
    <div style='margin-top: 20px; margin-right: 40px; margin-bottom: 40px'>
      <% @report.users.each do |user| %>
        <td class="col-xs-2"><%= link_to user.full_name, user_path(user), {:style => 'color:#0079bf; font-size: 18px; font-weight: bold; font-family: "Ubuntu"'} %></td><br>
      <%end %>
    </div>
  </div>

  <div>
    <h3>Projects </h3>
    <div style='margin-top: 20px; margin-bottom: 40px'>
      <% @report.projects.each do |project|%>
        <td class="col-xs-2"><%= link_to project.title, project_path(project), {:style => 'color:#0079bf; font-size: 18px; font-weight: bold; font-family: "Ubuntu"'} %></td><BR>
      <%end %>
    </div>
  </div>

  <div class = "col-xs-1" id="piechart"></div>
</div>

<div id='chart_div' style='width: 900px; height: 500px;'></div>
